{% extends "base.html" %}
{% block content %}

<h3 class="mb-4">Welcome {{ user.name }}</h3>

<!-- ================= UPLOAD SECTION ================= -->

<div class="card p-4 mb-4 shadow-sm">
    <h5>Upload Documents</h5>

    <form method="POST"
          action="{{ url_for('upload') }}"
          enctype="multipart/form-data">

        <input type="file"
               name="documents"
               multiple
               required
               class="form-control mb-3">

        <button type="submit"
                class="btn btn-primary">
            Upload
        </button>
    </form>
</div>


<!-- ================= DOCUMENTS SECTION ================= -->

<h5 class="mb-3">Your Documents</h5>

<form method="POST" action="{{ url_for('bulk_download') }}">

    <!-- Bulk Actions -->
    <div class="mb-3 d-flex gap-2">

        <button type="button"
                class="btn btn-sm btn-secondary"
                onclick="toggleSelectAll()">
            Select All
        </button>

        <button type="submit"
                class="btn btn-sm btn-success">
            Download Selected (ZIP)
        </button>

    </div>

    <div class="row">

        {% for doc in documents %}
        <div class="col-md-4">
            <div class="card p-3 mb-4 shadow-sm">

                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center">

                    <h6 class="mb-0">{{ doc.filename }}</h6>

                    {% if doc.status == "completed" %}
                    <input type="checkbox"
                           name="selected_docs"
                           value="{{ doc.id }}"
                           class="doc-checkbox">
                    {% endif %}

                </div>

                <!-- Status -->
                <div class="mt-2">
                    {% if doc.status == "processing" %}
                        <span class="text-warning">Processing</span>
                    {% elif doc.status == "completed" %}
                        <span class="text-success">Completed</span>
                    {% elif doc.status == "failed" %}
                        <span class="text-danger">Failed</span>
                    {% endif %}
                </div>

                <!-- Buttons -->
                <div class="mt-3 d-flex flex-wrap gap-2">

                    <!-- Open -->
                    <a href="{{ url_for('view_document', doc_id=doc.id) }}"
                       class="btn btn-sm btn-outline-primary">
                        Open
                    </a>

                    <!-- Download Buttons -->
                    {% if doc.status == "completed" %}

                    <a href="{{ url_for('download_pdf', doc_id=doc.id) }}"
                       class="btn btn-sm btn-outline-success">
                        PDF
                    </a>

                    <a href="{{ url_for('download_word', doc_id=doc.id) }}"
                       class="btn btn-sm btn-outline-dark">
                        Word
                    </a>

                    {% endif %}

                    <!-- Delete -->
                    <a href="{{ url_for('delete_document_user', doc_id=doc.id) }}"
                       class="btn btn-sm btn-outline-danger"
                       onclick="return confirm('Delete this document?')">
                        Delete
                    </a>

                </div>

            </div>
        </div>
        {% endfor %}

    </div>

</form>


<!-- ================= SELECT ALL SCRIPT ================= -->

<script>
function toggleSelectAll() {
    const checkboxes = document.querySelectorAll('.doc-checkbox');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);

    checkboxes.forEach(cb => {
        cb.checked = !allChecked;
    });
}
</script>

{% endblock %}